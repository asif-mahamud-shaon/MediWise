(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6027,e=>{"use strict";var t=e.i(52972),s=e.i(93661),a=e.i(42388),r=e.i(90503),l=e.i(66315);e.s(["default",0,({user:e,logout:i})=>{let n,o=(0,a.usePathname)(),[c,d]=(0,l.useState)(!1),x=[{href:"/patient/dashboard",label:"Dashboard",icon:r.FiHome},{href:"/patient/doctors",label:"Doctors",icon:r.FiUsers},{href:"/patient/appointments",label:"Appointments",icon:r.FiCalendar},{href:"/patient/chat",label:"Chats",icon:r.FiMessageCircle},{href:"/patient/prescriptions",label:"Prescriptions",icon:r.FiFileText},{href:"/patient/profile",label:"My Profile",icon:r.FiUser}];return(0,t.jsx)("div",{className:`${c?"w-16":"w-64"} bg-teal-600 text-white transition-all duration-300 fixed left-0 top-0 h-full z-20`,children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("button",{onClick:()=>d(!c),className:"w-full flex items-center justify-center p-2 hover:bg-teal-700 rounded-lg transition-colors mb-4",children:(0,t.jsx)(r.FiChevronRight,{className:`text-xl transform transition-transform ${c?"":"rotate-180"}`})}),!c&&(0,t.jsx)("div",{className:"flex items-center justify-center mb-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-2xl",children:"ðŸ©º"}),(0,t.jsx)("span",{className:"text-xl font-bold",children:"MediWise"})]})}),!c&&(0,t.jsx)("div",{className:"mb-6 pb-6 border-b border-teal-500",children:(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-sm font-semibold",children:(n=e?.name||"P",n?.split(" ")?.map(e=>e[0])?.join("")?.toUpperCase()?.slice(0,2)||"U")}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-semibold truncate",children:e?.name}),(0,t.jsx)("p",{className:"text-xs text-teal-200 capitalize",children:"Patient"})]})]})}),(0,t.jsx)("nav",{className:"space-y-1",children:x.map(e=>{let a=e.icon,r=o===e.href;return(0,t.jsxs)(s.default,{href:e.href,className:`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${r?"bg-teal-700 text-white font-semibold":"text-teal-100 hover:bg-teal-700 hover:text-white"}`,children:[(0,t.jsx)(a,{className:"text-xl flex-shrink-0"}),!c&&(0,t.jsx)("span",{className:"text-sm",children:e.label})]},e.href)})}),!c&&(0,t.jsx)("div",{className:"absolute bottom-4 left-4 right-4",children:(0,t.jsxs)("button",{onClick:i,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-teal-100 hover:bg-teal-700 transition-colors",children:[(0,t.jsx)(r.FiLogOut,{className:"text-xl"}),(0,t.jsx)("span",{className:"text-sm",children:"LOGOUT"})]})})]})})}])},65846,e=>{"use strict";var t=e.i(21055),s=e.i(49693),a=e.i(81294),r=e.i(56601),l=e.i(68808),i=e.i(1822);function n(e,t){let s=(0,i.toDate)(e)-(0,i.toDate)(t);return s<0?-1:s>0?1:s}var o=e.i(82746);function c(e,c){return function(e,t,c){var d;let x,m=(0,a.getDefaultOptions)(),u=c?.locale??m.locale??s.defaultLocale,h=n(e,t);if(isNaN(h))throw RangeError("Invalid time value");let f=Object.assign({},c,{addSuffix:c?.addSuffix,comparison:h}),[g,p]=(0,l.normalizeDates)(c?.in,...h>0?[t,e]:[e,t]),b=(d=void 0,e=>{let t=(d?Math[d]:Math.trunc)(e);return 0===t?0:t})(((0,i.toDate)(p)-(0,i.toDate)(g))/1e3),j=Math.round((b-((0,r.getTimezoneOffsetInMilliseconds)(p)-(0,r.getTimezoneOffsetInMilliseconds)(g))/1e3)/60);if(j<2)if(c?.includeSeconds)if(b<5)return u.formatDistance("lessThanXSeconds",5,f);else if(b<10)return u.formatDistance("lessThanXSeconds",10,f);else if(b<20)return u.formatDistance("lessThanXSeconds",20,f);else if(b<40)return u.formatDistance("halfAMinute",0,f);else if(b<60)return u.formatDistance("lessThanXMinutes",1,f);else return u.formatDistance("xMinutes",1,f);else if(0===j)return u.formatDistance("lessThanXMinutes",1,f);else return u.formatDistance("xMinutes",j,f);if(j<45)return u.formatDistance("xMinutes",j,f);if(j<90)return u.formatDistance("aboutXHours",1,f);if(j<o.minutesInDay){let e=Math.round(j/60);return u.formatDistance("aboutXHours",e,f)}if(j<2520)return u.formatDistance("xDays",1,f);else if(j<o.minutesInMonth){let e=Math.round(j/o.minutesInDay);return u.formatDistance("xDays",e,f)}else if(j<2*o.minutesInMonth)return x=Math.round(j/o.minutesInMonth),u.formatDistance("aboutXMonths",x,f);if((x=function(e,t,s){var a,r;let o,c,d,x,[m,u,h]=(0,l.normalizeDates)(void 0,e,e,t),f=n(u,h),g=Math.abs(function(e,t,s){let[a,r]=(0,l.normalizeDates)(void 0,e,t);return 12*(a.getFullYear()-r.getFullYear())+(a.getMonth()-r.getMonth())}(u,h));if(g<1)return 0;1===u.getMonth()&&u.getDate()>27&&u.setDate(30),u.setMonth(u.getMonth()-f*g);let p=n(u,h)===-f;+(o=(0,i.toDate)(m,void 0),a=void 0,(c=(0,i.toDate)(o,a?.in)).setHours(23,59,59,999),c)==+(r=void 0,x=(d=(0,i.toDate)(o,r?.in)).getMonth(),d.setFullYear(d.getFullYear(),x+1,0),d.setHours(23,59,59,999),d)&&1===g&&1===n(m,h)&&(p=!1);let b=f*(g-p);return 0===b?0:b}(p,g))<12){let e=Math.round(j/o.minutesInMonth);return u.formatDistance("xMonths",e,f)}{let e=x%12,t=Math.trunc(x/12);return e<3?u.formatDistance("aboutXYears",t,f):e<9?u.formatDistance("overXYears",t,f):u.formatDistance("almostXYears",t+1,f)}}(e,(0,t.constructFrom)(e,Date.now()),c)}e.s(["formatDistanceToNow",()=>c],65846)},68097,e=>{"use strict";var t=e.i(52972),s=e.i(66315),a=e.i(55236),r=e.i(72648),l=e.i(42388),i=e.i(51744),n=e.i(6027),o=e.i(81273),c=e.i(16639),d=e.i(65846),x=e.i(90503);function m(){let{user:e,loading:m,logout:u}=(0,a.useAuth)(),{showNotification:h}=(0,r.useNotification)(),f=(0,l.useRouter)(),[g,p]=(0,s.useState)([]),[b,j]=(0,s.useState)([]),[v,N]=(0,s.useState)(null),[y,w]=(0,s.useState)([]),[D,M]=(0,s.useState)(""),[C,S]=(0,s.useState)(!0),[F,T]=(0,s.useState)(0),[I,z]=(0,s.useState)(""),[R,E]=(0,s.useState)(!1),X=(0,s.useRef)(null);(0,s.useRef)(null),(0,s.useEffect)(()=>{m||e&&"patient"===e.role||f.push("/login")},[e,m,f]),(0,s.useEffect)(()=>{e&&"patient"===e.role&&($(),O(),U())},[e]),(0,s.useEffect)(()=>{if(e&&"patient"===e.role){let e=setInterval(()=>{$(),O(),U(),v&&P(v.id)},2e3);return()=>{clearInterval(e)}}},[e,v]),(0,s.useEffect)(()=>{L()},[y]);let L=()=>{X.current?.scrollIntoView({behavior:"smooth"})},$=async()=>{try{let e=((await o.default.get("/chat/users")).data.users||[]).filter(e=>"doctor"===e.role||"admin"===e.role);p(e)}catch(e){console.error("Error fetching chat users:",e)}},O=async()=>{try{let e=await o.default.get("/chat/conversations");j(e.data.conversations||[])}catch(e){console.error("Error fetching conversations:",e)}finally{S(!1)}},P=async e=>{try{let t=await o.default.get(`/chat/messages/${e}`);w(t.data.messages||[])}catch(e){console.error("Error fetching messages:",e)}},U=async()=>{try{let e=await o.default.get("/chat/unread-count");T(e.data.count||0)}catch(e){console.error("Error fetching unread count:",e)}},A=e=>{let t=b.find(t=>t.id===e.id);if(t)N(t),P(t.id),z(""),E(!1);else N({id:e.id,name:e.name,email:e.email,role:e.role,phone:e.phone,lastMessage:e.lastMessage||"No messages yet",lastMessageTime:e.lastMessageTime||new Date,unreadCount:e.unreadCount||0}),w([]);z(""),E(!1)},Y=g.filter(e=>e.name.toLowerCase().includes(I.toLowerCase())||e.email.toLowerCase().includes(I.toLowerCase())),B=async e=>{if(e.preventDefault(),D.trim()&&v)try{await o.default.post("/chat/send",{receiverId:v.id,content:D.trim()}),M(""),setTimeout(()=>{P(v.id),O(),$(),U()},100)}catch(e){console.error("Error sending message:",e),h("Failed to send message","error")}},k=e=>e?.split(" ")?.map(e=>e[0])?.join("")?.toUpperCase()?.slice(0,2)||"U";return m||C?(0,t.jsx)(i.default,{}):e&&"patient"===e.role?(0,t.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,t.jsx)(n.default,{user:e,logout:u}),(0,t.jsxs)("main",{className:"ml-64 flex-1 transition-all duration-300 flex flex-col h-screen",children:[(0,t.jsxs)("header",{className:"bg-white border-b border-gray-200 px-8 py-4 flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-800 uppercase tracking-wide",children:"MESSAGES"}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{className:"relative p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,t.jsx)(x.FiSearch,{className:"text-xl text-gray-600"})}),(0,t.jsxs)("button",{className:"relative p-2 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,t.jsx)(x.FiMessageCircle,{className:"text-xl text-gray-600"}),F>0&&(0,t.jsx)("span",{className:"absolute top-0 right-0 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:F})]}),(0,t.jsx)("button",{className:"relative p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,t.jsx)(x.FiBell,{className:"text-xl text-gray-600"})}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-teal-400 to-indigo-500 flex items-center justify-center text-white font-bold",children:k(e?.name||"P")})]})]}),(0,t.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,t.jsxs)("div",{className:"w-1/3 border-r border-gray-200 bg-white flex flex-col",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,t.jsxs)("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:["Conversations ",F>0&&`(${F})`]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:"text",value:I,onChange:e=>{z(e.target.value),E(e.target.value.length>0)},onFocus:()=>{I.length>0&&E(!0)},onBlur:()=>{setTimeout(()=>E(!1),200)},placeholder:"Search doctors...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"}),R&&Y.length>0&&(0,t.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:Y.slice(0,5).map(e=>(0,t.jsx)("div",{onMouseDown:t=>{t.preventDefault(),A(e)},className:"px-4 py-3 hover:bg-teal-50 cursor-pointer border-b border-gray-100 last:border-0",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-teal-400 to-indigo-500 flex items-center justify-center text-white font-bold text-sm",children:k(e.name)}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-semibold text-gray-800",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-600 capitalize",children:e.role}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["ID: ",e.id.slice(0,8),"..."]})]}),e.unreadCount>0&&(0,t.jsx)("span",{className:"bg-blue-600 text-white text-xs px-2 py-1 rounded-full",children:e.unreadCount})]})},e.id))})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===g.length?(0,t.jsx)("div",{className:"p-8 text-center text-gray-500",children:(0,t.jsx)("p",{children:"No users available"})}):g.map(e=>{let s=b.find(t=>t.id===e.id),a=v?.id===e.id,r=s||e;return(0,t.jsx)("div",{onClick:()=>A(e),className:`p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors ${a?"bg-teal-50 border-l-4 border-teal-600":""}`,children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-teal-400 to-indigo-500 flex items-center justify-center text-white font-bold",children:k(e.name)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-800 truncate",children:e.name}),r.lastMessageTime&&(0,t.jsx)("span",{className:"text-xs text-gray-500",children:(0,d.formatDistanceToNow)(new Date(r.lastMessageTime),{addSuffix:!0})})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 truncate mt-1",children:r.lastMessage||"No messages yet"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["ID: ",e.id.slice(0,8),"..."]}),(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"â€¢"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:e.role})]})]}),e.unreadCount>0&&(0,t.jsx)("span",{className:"bg-teal-600 text-white text-xs px-2 py-1 rounded-full",children:e.unreadCount})]})},e.id)})})]}),(0,t.jsx)("div",{className:"flex-1 flex flex-col bg-gray-50",children:v?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"bg-white border-b border-gray-200 p-4 flex items-center justify-between",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-teal-400 to-indigo-500 flex items-center justify-center text-white font-bold",children:k(v.name)}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-800",children:v.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:v.role})]})]})}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[y.map(s=>{let a=s.senderId===e.id;return(0,t.jsx)("div",{className:`flex ${a?"justify-end":"justify-start"}`,children:(0,t.jsxs)("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-2xl ${a?"bg-teal-600 text-white":"bg-white text-gray-800 border border-gray-200"}`,children:[!a&&(0,t.jsx)("p",{className:"text-xs font-semibold mb-1 opacity-75",children:s.sender.name}),(0,t.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:s.content}),(0,t.jsxs)("div",{className:`flex items-center gap-1 mt-1 ${a?"justify-end":"justify-start"}`,children:[(0,t.jsx)("p",{className:`text-xs ${a?"text-blue-100":"text-gray-500"}`,children:(0,c.format)(new Date(s.createdAt),"h:mm a")}),a&&(0,t.jsx)("div",{className:"flex items-center",children:s.isRead?(0,t.jsxs)("span",{className:"text-blue-300 text-xs ml-1 flex items-center gap-0.5",children:[(0,t.jsxs)("svg",{className:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,t.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"}),(0,t.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})]}),(0,t.jsx)("span",{className:"text-[10px]",children:"Seen"})]}):(0,t.jsx)("span",{className:"text-gray-300 text-xs ml-1",children:(0,t.jsx)("svg",{className:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})})]})]})},s.id)}),(0,t.jsx)("div",{ref:X})]}),(0,t.jsx)("div",{className:"bg-white border-t border-gray-200 p-4",children:(0,t.jsxs)("form",{onSubmit:B,className:"flex items-center gap-2",children:[(0,t.jsx)("button",{type:"button",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,t.jsx)(x.FiPaperclip,{className:"text-xl text-gray-600"})}),(0,t.jsx)("input",{type:"text",value:D,onChange:e=>M(e.target.value),placeholder:"Type a message...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-teal-500 focus:border-transparent"}),(0,t.jsx)("button",{type:"submit",disabled:!D.trim(),className:"p-2 bg-teal-600 text-white rounded-full hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:(0,t.jsx)(x.FiSend,{className:"text-xl"})})]})})]}):(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(x.FiMessageCircle,{className:"text-6xl text-gray-300 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-500 text-lg",children:"Select a conversation to start chatting"})]})})})]})]})]}):null}e.s(["default",()=>m])}]);