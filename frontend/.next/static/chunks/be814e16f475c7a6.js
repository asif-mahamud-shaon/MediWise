(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,19308,e=>{"use strict";var t=e.i(52972),s=e.i(66315),a=e.i(55236),r=e.i(72648),l=e.i(42388),i=e.i(93661),n=e.i(51744),d=e.i(6027),o=e.i(81273),c=e.i(16639),x=e.i(90503);function m(){let{user:e,loading:m,logout:g}=(0,a.useAuth)(),{showNotification:h}=(0,r.useNotification)(),u=(0,l.useRouter)(),[p,f]=(0,s.useState)(null),[b,y]=(0,s.useState)(!0),[j,N]=(0,s.useState)(!1),[v,w]=(0,s.useState)({}),[P,F]=(0,s.useState)(!1),[C,B]=(0,s.useState)(null),[O,k]=(0,s.useState)(null);(0,s.useEffect)(()=>{m||e&&"patient"===e.role||u.push("/login")},[e,m,u]),(0,s.useEffect)(()=>{e&&"patient"===e.role&&I()},[e]);let I=async()=>{try{y(!0);let e=(await o.default.get("/users/me/profile")).data.user,t={years:0,months:0};if(e?.dateOfBirth){let s=new Date(e.dateOfBirth),a=new Date,r=a.getFullYear()-s.getFullYear(),l=a.getMonth()-s.getMonth();l<0&&(r--,l+=12),a.getDate()<s.getDate()&&--l<0&&(r--,l+=11),t={years:r,months:l}}let s=(await o.default.get("/prescriptions?limit=100")).data.prescriptions||[],a=s.flatMap(e=>e.medicines||[]).filter((e,t,s)=>{let a="string"==typeof e?e:e.name||"";return s.findIndex(e=>("string"==typeof e?e:e.name||"")===a)===t}).map(e=>"string"==typeof e?{name:e,brand:""}:{name:e.name||e,brand:e.dosage||e.frequency||""}),r=s.filter(e=>e.instructions||e.diagnosis).map(e=>({date:e.prescriptionDate||e.createdAt,content:e.instructions||e.diagnosis||""})).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),l=e?.profileImage?`data:${e.profileImageMimeType||"image/jpeg"};base64,${e.profileImage}`:null,i={id:e?.id,displayId:e?.id?.slice(0,7),name:e?.name,profileImage:l,dateOfBirth:e?.dateOfBirth,weight:e?.weight||"",height:e?.height||"",age:t,address:e?.address||"",mobilePhone:e?.phone||"",homePhone:e?.homePhone||"",workPhone:e?.workPhone||"",email:e?.email,allergies:e?.allergies||[],medications:a,vitals:{bloodPressure:e?.bloodPressure||"",pulse:e?.pulse||""},notes:r,labResults:s.filter(e=>e.tests&&e.tests.length>0).flatMap(e=>(e.tests||[]).map(t=>({name:"string"==typeof t?t:t.name||t,date:e.prescriptionDate||e.createdAt}))).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())};f(i),w(i),k(l)}catch(e){console.error("Error fetching patient data:",e),e.response?.status===401||e.response?.status===403?u.push("/login"):f(null)}finally{y(!1)}},M=e=>e?.split(" ")?.map(e=>e[0])?.join("")?.toUpperCase()?.slice(0,2)||"U",S=e=>{try{let t=new Date(e);return(0,c.format)(t,"MM/dd/yyyy")}catch{return e}},A=e=>{try{let t=new Date(e);return(0,c.format)(t,"yyyy-MM-dd")}catch{return""}},D=async()=>{try{F(!0);let e=new FormData;e.append("name",v.name||""),e.append("phone",v.mobilePhone||""),e.append("address",v.address||""),v.dateOfBirth&&e.append("dateOfBirth",new Date(v.dateOfBirth).toISOString()),e.append("weight",v.weight||""),e.append("height",v.height||""),e.append("homePhone",v.homePhone||""),e.append("workPhone",v.workPhone||""),e.append("allergies",JSON.stringify(Array.isArray(v.allergies)?v.allergies:v.allergies?[v.allergies]:[])),e.append("bloodPressure",v.vitals?.bloodPressure||""),e.append("pulse",v.vitals?.pulse||""),C&&e.append("profileImage",C),v.removeProfileImage&&e.append("removeProfileImage","true"),(await o.default.put("/users/me/profile",e,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(await I(),N(!1),B(null),w({...v,removeProfileImage:!1}),h("Profile updated successfully!","success"))}catch(e){console.error("Error updating profile:",e),h(e.response?.data?.message||"Failed to update profile","error")}finally{F(!1)}};return m||b?(0,t.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,t.jsx)(d.default,{user:e,logout:g}),(0,t.jsx)("main",{className:"ml-64 flex-1",children:(0,t.jsx)(n.default,{})})]}):e&&"patient"===e.role?p?(0,t.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,t.jsx)(d.default,{user:e,logout:g}),(0,t.jsxs)("main",{className:"ml-64 flex-1 transition-all duration-300",children:[(0,t.jsxs)("header",{className:"bg-white border-b border-gray-200 px-8 py-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-800 uppercase tracking-wide",children:"MY PROFILE"}),!j&&(0,t.jsxs)("button",{onClick:()=>{N(!0),w({...p,dateOfBirth:p?.dateOfBirth?A(p.dateOfBirth):""})},className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors text-sm font-medium",children:[(0,t.jsx)(x.FiEdit3,{className:"text-sm"}),"Edit Profile"]}),j&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("button",{onClick:D,disabled:P,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium disabled:opacity-50",children:[(0,t.jsx)(x.FiSave,{className:"text-sm"}),P?"Saving...":"Save Changes"]}),(0,t.jsxs)("button",{onClick:()=>{N(!1),w(p)},disabled:P,className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm font-medium disabled:opacity-50",children:[(0,t.jsx)(x.FiX,{className:"text-sm"}),"Cancel"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{className:"relative p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,t.jsx)(x.FiSearch,{className:"text-xl text-gray-600"})}),(0,t.jsxs)(i.default,{href:"/patient/chat",className:"relative p-2 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,t.jsx)(x.FiMessageCircle,{className:"text-xl text-gray-600"}),(0,t.jsx)("span",{className:"absolute top-0 right-0 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:"2"})]}),(0,t.jsxs)("button",{className:"relative p-2 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,t.jsx)(x.FiBell,{className:"text-xl text-gray-600"}),(0,t.jsx)("span",{className:"absolute top-0 right-0 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:"2"})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-teal-400 to-indigo-500 flex items-center justify-center text-white font-bold",children:M(e?.name||"P")})]})]}),(0,t.jsx)("div",{className:"p-8",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:(0,t.jsxs)("div",{className:"flex flex-col items-center text-center mb-6",children:[(0,t.jsxs)("div",{className:"relative mb-4",children:[(0,t.jsx)("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-teal-400 to-indigo-500 flex items-center justify-center text-white text-3xl font-bold overflow-hidden",children:O?(0,t.jsx)("img",{src:O,alt:p?.name,className:"w-full h-full rounded-full object-cover"}):p?.profileImage?(0,t.jsx)("img",{src:p.profileImage,alt:p.name,className:"w-full h-full rounded-full object-cover"}):M(p?.name||"P")}),j&&(0,t.jsxs)("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2 flex gap-2",children:[(0,t.jsxs)("label",{className:"cursor-pointer bg-teal-600 text-white p-2 rounded-full hover:bg-teal-700 transition-colors shadow-lg",children:[(0,t.jsx)(x.FiEdit3,{className:"text-sm"}),(0,t.jsx)("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif",onChange:e=>{let t=e.target.files?.[0];if(t){if(t.size>2097152)return void h("Image size must be less than 2MB","warning");B(t);let e=new FileReader;e.onloadend=()=>{k(e.result)},e.readAsDataURL(t)}},className:"hidden"})]}),(O||p?.profileImage)&&(0,t.jsx)("button",{type:"button",onClick:()=>{B(null),k(null),w({...v,removeProfileImage:!0})},className:"bg-red-600 text-white p-2 rounded-full hover:bg-red-700 transition-colors shadow-lg",children:(0,t.jsx)(x.FiX,{className:"text-sm"})})]})]}),j?(0,t.jsx)("input",{type:"text",value:v.name||"",onChange:e=>w({...v,name:e.target.value}),className:"text-2xl font-bold text-gray-800 mb-2 text-center border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent w-full"}):(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:p?.name}),!j&&p?.allergies&&p.allergies.length>0&&(0,t.jsx)("div",{className:"inline-block px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium mb-4",children:"Allergy"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 w-full text-left",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"DOB"}),j?(0,t.jsx)("input",{type:"date",value:v.dateOfBirth?A(v.dateOfBirth):"",onChange:e=>w({...v,dateOfBirth:e.target.value}),className:"w-full text-sm font-semibold text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-800",children:p?.dateOfBirth?S(p.dateOfBirth):"N/A"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Weight"}),j?(0,t.jsx)("input",{type:"text",value:v.weight||"",onChange:e=>w({...v,weight:e.target.value}),placeholder:"e.g., 150 lb",className:"w-full text-sm font-semibold text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsxs)("p",{className:"text-sm font-semibold text-gray-800",children:[p?.weight||"N/A"," ",p?.weight?"lb":""]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Age"}),(0,t.jsxs)("p",{className:"text-sm font-semibold text-gray-800",children:[p?.age?.years||0,"y ",p?.age?.months||0,"m"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Height"}),j?(0,t.jsx)("input",{type:"text",value:v.height||"",onChange:e=>w({...v,height:e.target.value}),placeholder:"e.g., 5'8\"",className:"w-full text-sm font-semibold text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-800",children:p?.height||"N/A"})]})]}),(0,t.jsx)(i.default,{href:"/patient/chat",className:"w-full mt-6 px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium text-center",children:"SEND MESSAGE"})]})}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Current medications"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",children:(0,t.jsx)(x.FiPlus,{className:"text-gray-600"})}),(0,t.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",children:(0,t.jsx)(x.FiMoreVertical,{className:"text-gray-600"})})]})]}),(0,t.jsx)("div",{className:"space-y-3",children:p.medications&&p.medications.length>0?p.medications.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,t.jsx)(x.FiPackage,{className:"text-teal-600"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-800",children:e.name}),e.brand&&(0,t.jsx)("p",{className:"text-xs text-gray-600",children:e.brand})]})]},s)):(0,t.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No medications found"})})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Contact Information"}),(0,t.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Home Address"}),j?(0,t.jsx)("textarea",{value:v.address||"",onChange:e=>w({...v,address:e.target.value}),placeholder:"Enter your address",className:"w-full text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent",rows:2}):(0,t.jsx)("p",{className:"text-gray-800",children:p.address||"Not provided"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Mobile Phone #"}),j?(0,t.jsx)("input",{type:"tel",value:v.mobilePhone||"",onChange:e=>w({...v,mobilePhone:e.target.value}),placeholder:"Enter mobile phone",className:"w-full text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-gray-800",children:p.mobilePhone||"Not provided"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Home Phone #"}),j?(0,t.jsx)("input",{type:"tel",value:v.homePhone||"",onChange:e=>w({...v,homePhone:e.target.value}),placeholder:"Enter home phone",className:"w-full text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-gray-800",children:p.homePhone||"Not provided"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Work Phone #"}),j?(0,t.jsx)("input",{type:"tel",value:v.workPhone||"",onChange:e=>w({...v,workPhone:e.target.value}),placeholder:"Enter work phone",className:"w-full text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-gray-800",children:p.workPhone||"Not provided"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Email"}),(0,t.jsx)("p",{className:"text-gray-800",children:p.email})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Vitals"}),!j&&(0,t.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",children:(0,t.jsx)(x.FiMoreVertical,{className:"text-gray-600"})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:(0,t.jsx)(x.FiHeart,{className:"text-red-600 text-xl"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Blood Pressure"}),j?(0,t.jsx)("input",{type:"text",value:v.vitals?.bloodPressure||"",onChange:e=>w({...v,vitals:{...v.vitals,bloodPressure:e.target.value}}),placeholder:"e.g., 120/80",className:"w-full text-lg font-bold text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-lg font-bold text-gray-800",children:p.vitals?.bloodPressure||"N/A"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:(0,t.jsx)(x.FiActivity,{className:"text-blue-600 text-xl"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Pulse"}),j?(0,t.jsx)("input",{type:"text",value:v.vitals?.pulse||"",onChange:e=>w({...v,vitals:{...v.vitals,pulse:e.target.value}}),placeholder:"e.g., 72 bpm",className:"w-full text-lg font-bold text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-lg font-bold text-gray-800",children:p.vitals?.pulse||"N/A"})]})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Notes"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",children:(0,t.jsx)(x.FiPlus,{className:"text-gray-600"})}),(0,t.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",children:(0,t.jsx)(x.FiMoreVertical,{className:"text-gray-600"})})]})]}),(0,t.jsx)("div",{className:"space-y-3",children:p.notes&&p.notes.length>0?p.notes.map((e,s)=>(0,t.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:S(e.date)}),(0,t.jsx)("p",{className:"text-sm text-gray-800 leading-relaxed",children:e.content})]},s)):(0,t.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No notes found"})})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Lab results"}),(0,t.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",children:(0,t.jsx)(x.FiMoreVertical,{className:"text-gray-600"})})]}),(0,t.jsx)("div",{className:"space-y-3",children:p.labResults&&p.labResults.length>0?p.labResults.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center flex-shrink-0",children:(0,t.jsx)(x.FiFileText,{className:"text-teal-600"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-800 truncate",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:S(e.date)})]})]},s)):(0,t.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No lab results found"})})]})]})})]})]}):(0,t.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,t.jsx)(d.default,{user:e,logout:g}),(0,t.jsx)("main",{className:"ml-64 flex-1 p-8",children:(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:(0,t.jsx)("p",{className:"text-gray-500 text-lg",children:"No profile data available. Please refresh the page."})})})]}):null}function m(){let{user:e,loading:m,logout:g}=(0,a.useAuth)(),{showNotification:h}=(0,r.useNotification)(),u=(0,l.useRouter)(),[p,f]=(0,s.useState)(null),[b,y]=(0,s.useState)(!0),[j,N]=(0,s.useState)(!1),[v,w]=(0,s.useState)({}),[P,F]=(0,s.useState)(!1),[C,B]=(0,s.useState)(null),[O,k]=(0,s.useState)(null);(0,s.useEffect)(()=>{m||e&&"patient"===e.role||u.push("/login")},[e,m,u]),(0,s.useEffect)(()=>{e&&"patient"===e.role&&I()},[e]);let I=async()=>{try{y(!0);let e=(await o.default.get("/users/me/profile")).data.user,t={years:0,months:0};if(e?.dateOfBirth){let s=new Date(e.dateOfBirth),a=new Date,r=a.getFullYear()-s.getFullYear(),l=a.getMonth()-s.getMonth();l<0&&(r--,l+=12),a.getDate()<s.getDate()&&--l<0&&(r--,l+=11),t={years:r,months:l}}let s=(await o.default.get("/prescriptions?limit=100")).data.prescriptions||[],a=s.flatMap(e=>e.medicines||[]).filter((e,t,s)=>{let a="string"==typeof e?e:e.name||"";return s.findIndex(e=>("string"==typeof e?e:e.name||"")===a)===t}).map(e=>"string"==typeof e?{name:e,brand:""}:{name:e.name||e,brand:e.dosage||e.frequency||""}),r=s.filter(e=>e.instructions||e.diagnosis).map(e=>({date:e.prescriptionDate||e.createdAt,content:e.instructions||e.diagnosis||""})).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),l=e?.profileImage?`data:${e.profileImageMimeType||"image/jpeg"};base64,${e.profileImage}`:null,i={id:e?.id,displayId:e?.id?.slice(0,7),name:e?.name,profileImage:l,dateOfBirth:e?.dateOfBirth,weight:e?.weight||"",height:e?.height||"",age:t,address:e?.address||"",mobilePhone:e?.phone||"",homePhone:e?.homePhone||"",workPhone:e?.workPhone||"",email:e?.email,allergies:e?.allergies||[],medications:a,vitals:{bloodPressure:e?.bloodPressure||"",pulse:e?.pulse||""},notes:r,labResults:s.filter(e=>e.tests&&e.tests.length>0).flatMap(e=>(e.tests||[]).map(t=>({name:"string"==typeof t?t:t.name||t,date:e.prescriptionDate||e.createdAt}))).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())};f(i),w(i),k(l)}catch(e){console.error("Error fetching patient data:",e),e.response?.status===401||e.response?.status===403?u.push("/login"):f(null)}finally{y(!1)}},M=e=>e?.split(" ")?.map(e=>e[0])?.join("")?.toUpperCase()?.slice(0,2)||"U",S=e=>{try{let t=new Date(e);return(0,c.format)(t,"MM/dd/yyyy")}catch{return e}},A=e=>{try{let t=new Date(e);return(0,c.format)(t,"yyyy-MM-dd")}catch{return""}},D=async()=>{try{F(!0);let e=new FormData;e.append("name",v.name||""),e.append("phone",v.mobilePhone||""),e.append("address",v.address||""),v.dateOfBirth&&e.append("dateOfBirth",new Date(v.dateOfBirth).toISOString()),e.append("weight",v.weight||""),e.append("height",v.height||""),e.append("homePhone",v.homePhone||""),e.append("workPhone",v.workPhone||""),e.append("allergies",JSON.stringify(Array.isArray(v.allergies)?v.allergies:v.allergies?[v.allergies]:[])),e.append("bloodPressure",v.vitals?.bloodPressure||""),e.append("pulse",v.vitals?.pulse||""),C&&e.append("profileImage",C),v.removeProfileImage&&e.append("removeProfileImage","true"),(await o.default.put("/users/me/profile",e,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(await I(),N(!1),B(null),w({...v,removeProfileImage:!1}),h("Profile updated successfully!","success"))}catch(e){console.error("Error updating profile:",e),h(e.response?.data?.message||"Failed to update profile","error")}finally{F(!1)}};return m||b?(0,t.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,t.jsx)(d.default,{user:e,logout:g}),(0,t.jsx)("main",{className:"ml-64 flex-1",children:(0,t.jsx)(n.default,{})})]}):e&&"patient"===e.role?p?(0,t.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,t.jsx)(d.default,{user:e,logout:g}),(0,t.jsxs)("main",{className:"ml-64 flex-1 transition-all duration-300",children:[(0,t.jsxs)("header",{className:"bg-white border-b border-gray-200 px-8 py-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-800 uppercase tracking-wide",children:"MY PROFILE"}),!j&&(0,t.jsxs)("button",{onClick:()=>{N(!0),w({...p,dateOfBirth:p?.dateOfBirth?A(p.dateOfBirth):""})},className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors text-sm font-medium",children:[(0,t.jsx)(x.FiEdit3,{className:"text-sm"}),"Edit Profile"]}),j&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("button",{onClick:D,disabled:P,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium disabled:opacity-50",children:[(0,t.jsx)(x.FiSave,{className:"text-sm"}),P?"Saving...":"Save Changes"]}),(0,t.jsxs)("button",{onClick:()=>{N(!1),w(p)},disabled:P,className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm font-medium disabled:opacity-50",children:[(0,t.jsx)(x.FiX,{className:"text-sm"}),"Cancel"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{className:"relative p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,t.jsx)(x.FiSearch,{className:"text-xl text-gray-600"})}),(0,t.jsxs)(i.default,{href:"/patient/chat",className:"relative p-2 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,t.jsx)(x.FiMessageCircle,{className:"text-xl text-gray-600"}),(0,t.jsx)("span",{className:"absolute top-0 right-0 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:"2"})]}),(0,t.jsxs)("button",{className:"relative p-2 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,t.jsx)(x.FiBell,{className:"text-xl text-gray-600"}),(0,t.jsx)("span",{className:"absolute top-0 right-0 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:"2"})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-teal-400 to-indigo-500 flex items-center justify-center text-white font-bold",children:M(e?.name||"P")})]})]}),(0,t.jsx)("div",{className:"p-8",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:(0,t.jsxs)("div",{className:"flex flex-col items-center text-center mb-6",children:[(0,t.jsxs)("div",{className:"relative mb-4",children:[(0,t.jsx)("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-teal-400 to-indigo-500 flex items-center justify-center text-white text-3xl font-bold overflow-hidden",children:O?(0,t.jsx)("img",{src:O,alt:p?.name,className:"w-full h-full rounded-full object-cover"}):p?.profileImage?(0,t.jsx)("img",{src:p.profileImage,alt:p.name,className:"w-full h-full rounded-full object-cover"}):M(p?.name||"P")}),j&&(0,t.jsxs)("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2 flex gap-2",children:[(0,t.jsxs)("label",{className:"cursor-pointer bg-teal-600 text-white p-2 rounded-full hover:bg-teal-700 transition-colors shadow-lg",children:[(0,t.jsx)(x.FiEdit3,{className:"text-sm"}),(0,t.jsx)("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif",onChange:e=>{let t=e.target.files?.[0];if(t){if(t.size>2097152)return void h("Image size must be less than 2MB","warning");B(t);let e=new FileReader;e.onloadend=()=>{k(e.result)},e.readAsDataURL(t)}},className:"hidden"})]}),(O||p?.profileImage)&&(0,t.jsx)("button",{type:"button",onClick:()=>{B(null),k(null),w({...v,removeProfileImage:!0})},className:"bg-red-600 text-white p-2 rounded-full hover:bg-red-700 transition-colors shadow-lg",children:(0,t.jsx)(x.FiX,{className:"text-sm"})})]})]}),j?(0,t.jsx)("input",{type:"text",value:v.name||"",onChange:e=>w({...v,name:e.target.value}),className:"text-2xl font-bold text-gray-800 mb-2 text-center border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent w-full"}):(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:p?.name}),!j&&p?.allergies&&p.allergies.length>0&&(0,t.jsx)("div",{className:"inline-block px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium mb-4",children:"Allergy"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 w-full text-left",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"DOB"}),j?(0,t.jsx)("input",{type:"date",value:v.dateOfBirth?A(v.dateOfBirth):"",onChange:e=>w({...v,dateOfBirth:e.target.value}),className:"w-full text-sm font-semibold text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-800",children:p?.dateOfBirth?S(p.dateOfBirth):"N/A"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Weight"}),j?(0,t.jsx)("input",{type:"text",value:v.weight||"",onChange:e=>w({...v,weight:e.target.value}),placeholder:"e.g., 150 lb",className:"w-full text-sm font-semibold text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsxs)("p",{className:"text-sm font-semibold text-gray-800",children:[p?.weight||"N/A"," ",p?.weight?"lb":""]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Age"}),(0,t.jsxs)("p",{className:"text-sm font-semibold text-gray-800",children:[p?.age?.years||0,"y ",p?.age?.months||0,"m"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Height"}),j?(0,t.jsx)("input",{type:"text",value:v.height||"",onChange:e=>w({...v,height:e.target.value}),placeholder:"e.g., 5'8\"",className:"w-full text-sm font-semibold text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-800",children:p?.height||"N/A"})]})]}),(0,t.jsx)(i.default,{href:"/patient/chat",className:"w-full mt-6 px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium text-center",children:"SEND MESSAGE"})]})}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Current medications"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",children:(0,t.jsx)(x.FiPlus,{className:"text-gray-600"})}),(0,t.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",children:(0,t.jsx)(x.FiMoreVertical,{className:"text-gray-600"})})]})]}),(0,t.jsx)("div",{className:"space-y-3",children:p.medications&&p.medications.length>0?p.medications.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,t.jsx)(x.FiPackage,{className:"text-teal-600"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-800",children:e.name}),e.brand&&(0,t.jsx)("p",{className:"text-xs text-gray-600",children:e.brand})]})]},s)):(0,t.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No medications found"})})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Contact Information"}),(0,t.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Home Address"}),j?(0,t.jsx)("textarea",{value:v.address||"",onChange:e=>w({...v,address:e.target.value}),placeholder:"Enter your address",className:"w-full text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent",rows:2}):(0,t.jsx)("p",{className:"text-gray-800",children:p.address||"Not provided"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Mobile Phone #"}),j?(0,t.jsx)("input",{type:"tel",value:v.mobilePhone||"",onChange:e=>w({...v,mobilePhone:e.target.value}),placeholder:"Enter mobile phone",className:"w-full text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-gray-800",children:p.mobilePhone||"Not provided"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Home Phone #"}),j?(0,t.jsx)("input",{type:"tel",value:v.homePhone||"",onChange:e=>w({...v,homePhone:e.target.value}),placeholder:"Enter home phone",className:"w-full text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-gray-800",children:p.homePhone||"Not provided"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Work Phone #"}),j?(0,t.jsx)("input",{type:"tel",value:v.workPhone||"",onChange:e=>w({...v,workPhone:e.target.value}),placeholder:"Enter work phone",className:"w-full text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-gray-800",children:p.workPhone||"Not provided"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Email"}),(0,t.jsx)("p",{className:"text-gray-800",children:p.email})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Vitals"}),!j&&(0,t.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",children:(0,t.jsx)(x.FiMoreVertical,{className:"text-gray-600"})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:(0,t.jsx)(x.FiHeart,{className:"text-red-600 text-xl"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Blood Pressure"}),j?(0,t.jsx)("input",{type:"text",value:v.vitals?.bloodPressure||"",onChange:e=>w({...v,vitals:{...v.vitals,bloodPressure:e.target.value}}),placeholder:"e.g., 120/80",className:"w-full text-lg font-bold text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-lg font-bold text-gray-800",children:p.vitals?.bloodPressure||"N/A"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:(0,t.jsx)(x.FiActivity,{className:"text-blue-600 text-xl"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Pulse"}),j?(0,t.jsx)("input",{type:"text",value:v.vitals?.pulse||"",onChange:e=>w({...v,vitals:{...v.vitals,pulse:e.target.value}}),placeholder:"e.g., 72 bpm",className:"w-full text-lg font-bold text-gray-800 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent"}):(0,t.jsx)("p",{className:"text-lg font-bold text-gray-800",children:p.vitals?.pulse||"N/A"})]})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Notes"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",children:(0,t.jsx)(x.FiPlus,{className:"text-gray-600"})}),(0,t.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",children:(0,t.jsx)(x.FiMoreVertical,{className:"text-gray-600"})})]})]}),(0,t.jsx)("div",{className:"space-y-3",children:p.notes&&p.notes.length>0?p.notes.map((e,s)=>(0,t.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:S(e.date)}),(0,t.jsx)("p",{className:"text-sm text-gray-800 leading-relaxed",children:e.content})]},s)):(0,t.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No notes found"})})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Lab results"}),(0,t.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",children:(0,t.jsx)(x.FiMoreVertical,{className:"text-gray-600"})})]}),(0,t.jsx)("div",{className:"space-y-3",children:p.labResults&&p.labResults.length>0?p.labResults.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center flex-shrink-0",children:(0,t.jsx)(x.FiFileText,{className:"text-teal-600"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-800 truncate",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:S(e.date)})]})]},s)):(0,t.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No lab results found"})})]})]})})]})]}):(0,t.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,t.jsx)(d.default,{user:e,logout:g}),(0,t.jsx)("main",{className:"ml-64 flex-1 p-8",children:(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:(0,t.jsx)("p",{className:"text-gray-500 text-lg",children:"No profile data available. Please refresh the page."})})})]}):null}e.s(["default",()=>m])}]);